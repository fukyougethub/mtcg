<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Comp Generator</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;background:#f7f7fb;color:#111;margin:0;padding:20px}
    .container{max-width:1000px;margin:0 auto;background:#fff;border-radius:12px;padding:18px;box-shadow:0 6px 30px rgba(18,24,40,0.06)}
    h1{font-size:18px;margin:0 0 12px}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px}
    label{display:flex;align-items:center;gap:8px;padding:6px;border-radius:6px}
    .controls{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap}
    button{padding:8px 12px;border-radius:8px;border:0;background:#2563eb;color:white;cursor:pointer}
    button.secondary{background:#6b7280}
    .output{margin-top:12px;padding:10px;background:#f3f4f6;border-radius:8px;white-space:pre-wrap}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,0.35);display:flex;align-items:center;justify-content:center}
    .modal .panel{background:white;padding:16px;border-radius:8px;max-width:560px;width:100%}
    .small{font-size:13px;color:#374151}
    input[type=text],input[type=number],select{width:100%;padding:8px;border-radius:6px;border:1px solid #e5e7eb}
    .row{display:flex;gap:8px}
    .hint{font-size:12px;color:#6b7280}
  </style>
</head>
<body>
  <div class="container">
    <h1>Pick 6 troops for the rating: (11.11 is the max points a team could be)</h1>
    <div id="pieces" class="grid"></div>

    <!-- NEW RULER SELECT -->
    <div style="margin-top:10px;">
      <label for="ruler">Select Ruler:</label>
      <select id="ruler">
        <option value="Royale King">Royale King</option>
        <option value="Spirit Empress">Spirit Empress</option>
        <option value="Goblin Queen">Goblin Queen</option>
      </select>
    </div>

    <div class="controls">
      <button id="rateBtn">Rate my team</button>
      <button id="genBtn">Generate a good team</button>
      <button id="customBtn" class="secondary">Custom Team Finder</button>
      <button id="bestBtn" class="secondary">Find BEST possible team</button>
      <div style="margin-left:auto" class="hint">Total pieces: <span id="totalCount"></span></div>
    </div>

    <div id="out" class="output">Results will appear here.</div>
  </div>

  <!-- existing modal below remains unchanged -->
  <div id="modal" class="modal" style="display:none">
    <div class="panel">
      <h3>Custom Team Options</h3>
      <label class="small">Minimum Score:</label>
      <input id="minScore" type="number" step="0.1" value="10.0" />
      <label class="small" style="margin-top:8px">Required Troops (comma separated):</label>
      <input id="reqTroops" type="text" placeholder="e.g. PRINCE, WIZARD" />
      <label class="small" style="margin-top:8px">Required Groups (format: GROUP:count, comma separated):</label>
      <input id="reqGroups" type="text" placeholder="e.g. NOBLE:2, UNDEAD:1" />
      <div style="margin-top:10px;display:flex;gap:8px;justify-content:flex-end">
        <button id="findCustom">Find Team</button>
        <button id="closeModal" class="secondary">Close</button>
      </div>
    </div>
  </div>

  <script>
    // ---- Data ----
    const TYPES = ["TANK", "ASSASSIN", "DAMAGE DEALER", "CONTROLLER", "MARKSMEN", "ARTILLERY"];

    const GROUPS = {
      "NOBLE": ["KNIGHT", "PRINCE", "PRINCESS", "GOLDEN KNIGHT", "MUSKETEER"],
      "JUGGERNAUT": ["KNIGHT", "VALKYRIE", "GOBLIN MACHINE", "SKELETON KING"],
      "CLAN": ["ARCHER", "BARBARIAN", "VALKYRIE", "ARCHER QUEEN"],
      "RANGER": ["ARCHER", "DART GOBLIN", "PRINCESS", "SKELETON DRAGONS"],
      "GOBLIN": ["GOBLINS", "SPEAR GOBLINS", "DART GOBLIN", "GOBLIN MACHINE"],
      "ASSASSIN": ["GOBLINS", "ROYAL GHOST", "GOLDEN KNIGHT", "BANDIT"],
      "BLASTER": ["SPEAR GOBLINS", "BABY DRAGON", "EXECUTIONER", "MUSKETEER"],
      "BRAWLER": ["BARBARIAN", "PRINCE", "GIANT SKELETON", "MEGA KNIGHT"],
      "AVENGER": ["PEKKA", "ELECTRO GIANT", "ARCHER QUEEN", "WITCH"],
      "ACE": ["PEKKA", "EXECUTIONER", "MEGA KNIGHT", "BANDIT"],
      "UNDEAD": ["WITCH", "GIANT SKELETON", "ROYAL GHOST", "SKELETON KING", "SKELETON DRAGONS"],
      "MAGE": ["WIZARD", "ELECTRO WIZARD"],
      "FIRE": ["WIZARD", "BABY DRAGON"],
      "ELECTRIC": ["ELECTRO GIANT", "ELECTRO WIZARD"],
    };

    const GROUP_RANKINGS = {
      "NOBLE": 5, "JUGGERNAUT": 5, "CLAN": 3, "RANGER": 2, "GOBLIN": 4, "ASSASSIN": 1,
      "BLASTER": 4, "BRAWLER": 1, "AVENGER": 3, "ACE": 5, "UNDEAD": 5, "MAGE": 2,
      "FIRE": 3, "ELECTRIC": 2,
    };

    function getBonusMultiplier(b){ if(b===1)return 0.95; if(b===2)return 0.98; if(b===3)return 1.0; if(b===4)return 1.03; if(b===5)return 1.05; return 1.0; }

    // ---- PIECES WITH COST ----
    const PIECES = {
      "KNIGHT": {"type":"TANK","group1":"NOBLE","group2":"JUGGERNAUT","bonus":1,"cost":3},
      "PRINCE": {"type":"TANK","group1":"NOBLE","group2":"BRAWLER","bonus":3,"cost":4},
      "PRINCESS": {"type":"ARTILLERY","group1":"NOBLE","group2":"RANGER","bonus":4,"cost":3},
      "GOLDEN KNIGHT": {"type":"ASSASSIN","group1":"NOBLE","group2":"ASSASSIN","bonus":5,"cost":5},
      "PEKKA": {"type":"DAMAGE DEALER","group1":"AVENGER","group2":"ACE","bonus":3,"cost":5},
      "GOBLIN MACHINE": {"type":"CONTROLLER","group1":"JUGGERNAUT","group2":"GOBLIN","bonus":4,"cost":4},
      "SKELETON KING": {"type":"DAMAGE DEALER","group1":"JUGGERNAUT","group2":"UNDEAD","bonus":4,"cost":4},
      "ARCHER": {"type":"MARKSMEN","group1":"CLAN","group2":"RANGER","bonus":3,"cost":2},
      "BARBARIAN": {"type":"CONTROLLER","group1":"CLAN","group2":"BRAWLER","bonus":2,"cost":2},
      "VALKYRIE": {"type":"TANK","group1":"CLAN","group2":"JUGGERNAUT","bonus":3,"cost":3},
      "ARCHER QUEEN": {"type":"MARKSMEN","group1":"CLAN","group2":"AVENGER","bonus":5,"cost":5},
      "DART GOBLIN": {"type":"MARKSMEN","group1":"GOBLIN","group2":"RANGER","bonus":2,"cost":3},
      "GOBLINS": {"type":"ASSASSIN","group1":"GOBLIN","group2":"ASSASSIN","bonus":2,"cost":2},
      "SPEAR GOBLINS": {"type":"DAMAGE DEALER","group1":"GOBLIN","group2":"BLASTER","bonus":1,"cost":2},
      "ROYAL GHOST": {"type":"ASSASSIN","group1":"ASSASSIN","group2":"UNDEAD","bonus":5,"cost":4},
      "WIZARD": {"type":"ARTILLERY","group1":"FIRE","group2":"MAGE","bonus":3,"cost":3},
      "EXECUTIONER": {"type":"ARTILLERY","group1":"BLASTER","group2":"ACE","bonus":3,"cost":4},
      "GIANT SKELETON": {"type":"DAMAGE DEALER","group1":"BRAWLER","group2":"UNDEAD","bonus":4,"cost":4},
      "MEGA KNIGHT": {"type":"TANK","group1":"BRAWLER","group2":"ACE","bonus":4,"cost":5},
      "BANDIT": {"type":"ASSASSIN","group1":"ASSASSIN","group2":"ACE","bonus":4,"cost":3},
      "SKELETON DRAGONS": {"type":"CONTROLLER","group1":"UNDEAD","group2":"RANGER","bonus":2,"cost":3},
      "ELECTRO GIANT": {"type":"TANK","group1":"ELECTRIC","group2":"AVENGER","bonus":3,"cost":5},
      "MUSKETEER": {"type":"MARKSMEN","group1":"NOBLE","group2":"BLASTER","bonus":3,"cost":3},
      "BABY DRAGON": {"type":"DAMAGE DEALER","group1":"FIRE","group2":"BLASTER","bonus":4,"cost":4},
      "ELECTRO WIZARD": {"type":"CONTROLLER","group1":"MAGE","group2":"ELECTRIC","bonus":5,"cost":4},
      "WITCH": {"type":"CONTROLLER","group1":"UNDEAD","group2":"AVENGER","bonus":3,"cost":4},
    };

    function getGroupMultiplier(g){
      const rank = GROUP_RANKINGS[g] ?? 2;
      if(rank===1)return 0.8; if(rank===2)return 0.9; if(rank===3)return 1.0; if(rank===4)return 1.125; if(rank===5)return 1.25;
      return 1.0;
    }

    function scoreGroup(chosenIds){
      const chosenSet = new Set(chosenIds);
      let score = 0;

      for(const [gname,members] of Object.entries(GROUPS)){
        const active = members.filter(m=>chosenSet.has(m)).length;
        const multiplier = getGroupMultiplier(gname);
        if(members.length===3){ if(active===3)score+=2*multiplier; }
        else if(members.length===4){ if(active>=2)score+=1*multiplier; if(active===4)score+=2*multiplier; }
        else if(members.length===2){ if(active>=2)score+=1.5*multiplier; }
        else if(members.length===5){ if(active>=2)score+=1*multiplier; if(active===4)score+=2*multiplier; }
      }

      const chosenTypes = new Set(chosenIds.map(p=>PIECES[p].type));
      if(chosenTypes.size>1)score+=chosenTypes.size/2;

      let bonusMultiplier=1;
      for(const pid of chosenIds){ bonusMultiplier*=getBonusMultiplier(PIECES[pid].bonus); }
      let totalCost = chosenIds.reduce((s,p)=>s+PIECES[p].cost,0);
      let finalScore = score * bonusMultiplier;

      // --- APPLY RULER MULTIPLIER ---
      const ruler = document.getElementById("ruler").value;
      if(ruler==="Royale King"){
        finalScore *= 1.1;
      } else if(ruler==="Spirit Empress"){
        if(totalCost>20) finalScore *= 1.2;
      } else if(ruler==="Goblin Queen"){
        const hasGoblin = chosenSet.has("GOBLINS");
        const hasSpear = chosenSet.has("SPEAR GOBLINS");
        const hasDart = chosenSet.has("DART GOBLIN");
        const hasMachine = chosenSet.has("GOBLIN MACHINE");
        const goblinSet = hasGoblin && hasSpear && hasDart && hasMachine;
        if(goblinSet) finalScore *= 1.5;
        else if(
          (hasGoblin && hasSpear) ||
          (hasDart && hasSpear) ||
          (hasDart && hasGoblin) ||
          (hasDart && hasSpear && hasGoblin)
        ) finalScore *= 1.25;
      }

      return finalScore;
    }

    // everything else (UI wiring, generate, etc.) stays the same
    // ...
  </script>
</body>
</html>
