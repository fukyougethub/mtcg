<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Team Rater</title>
<style>
  body { font-family: sans-serif; background: #111; color: #eee; text-align: center; }
  select, button, input { margin: 4px; }
  #result { white-space: pre-wrap; margin-top: 10px; }
  #modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); justify-content:center; align-items:center; }
  #modalContent { background:#222; padding:20px; border-radius:10px; }
</style>
</head>
<body>
<h2>Team Rater</h2>

<select id="ruler">
  <option value="Royale King">Royale King</option>
  <option value="Spirit Empress">Spirit Empress</option>
  <option value="Goblin Queen">Goblin Queen</option>
  <option value="Elixir Loong">Elixir Loong</option>
</select>
<button id="randomBtn">Random Team</button>
<button id="rateBtn">Rate My Team</button>
<button id="customBtn">Custom Finder</button>
<button id="bestBtn">Best Team</button>

<div id="team"></div>
<div id="result"></div>

<div id="modal">
  <div id="modalContent">
    <h3>Custom Finder</h3>
    <label>Min Score:</label><input id="minScore" type="number" step="0.01"><br>
    <label>Required Troops (comma):</label><input id="reqTroops" type="text"><br>
    <label>Required Groups (e.g., HUMAN:2, BEAST:1):</label><input id="reqGroups" type="text"><br>
    <button id="findCustom">Find</button>
    <button id="closeModal">Close</button>
  </div>
</div>

<script>
// --- sample troop data ---
const PIECES = {
  "Knight":{type:"Melee",group1:"HUMAN",group2:"ROYAL",bonus:1.2,cost:3},
  "Archer":{type:"Ranged",group1:"HUMAN",group2:"FOREST",bonus:1.1,cost:2},
  "Mage":{type:"Magic",group1:"HUMAN",group2:"ARCANE",bonus:1.4,cost:4},
  "Goblin":{type:"Melee",group1:"BEAST",group2:"CAVE",bonus:0.9,cost:1},
  "Dragon":{type:"Magic",group1:"DRAGON",group2:"FIRE",bonus:1.8,cost:5},
  "Priest":{type:"Support",group1:"HUMAN",group2:"HOLY",bonus:1.3,cost:3},
  "Wolf":{type:"Melee",group1:"BEAST",group2:"FOREST",bonus:1.0,cost:2},
  "Elf":{type:"Ranged",group1:"FOREST",group2:"ARCANE",bonus:1.2,cost:3},
  "Giant":{type:"Tank",group1:"MOUNTAIN",group2:"BEAST",bonus:1.5,cost:4},
  "Witch":{type:"Magic",group1:"ARCANE",group2:"CAVE",bonus:1.6,cost:4}
};

const GROUPS = {};
for(const [k,v] of Object.entries(PIECES)){
  [v.group1,v.group2].forEach(g=>{
    if(!GROUPS[g]) GROUPS[g]=[];
    GROUPS[g].push(k);
  });
}

const allIds = Object.keys(PIECES);

function scoreGroup(chosen){
  let base=0;
  for(const id of chosen){
    const p=PIECES[id];
    base += p.bonus*2 + p.cost;
  }
  const uniqueGroups = new Set(chosen.flatMap(id=>[PIECES[id].group1,PIECES[id].group2])).size;
  let final = base * (1 + uniqueGroups*0.05);

  const ruler = document.getElementById('ruler').value;
  if(ruler==="Royale King") final *= 1.1;
  else if(ruler==="Spirit Empress") final *= 1.2;
  else if(ruler==="Goblin Queen") final *= 1.15;
  else if(ruler==="Elixir Loong") final *= 1.05; // new 1.05x multiplier
  return final;
}

function showResult(title, details){
  document.getElementById('result').textContent = `${title}\n\n${details}`;
}

// --- random choice helper ---
function randomChoice(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

document.getElementById('randomBtn').addEventListener('click',()=>{
  const ruler = document.getElementById('ruler').value;
  const teamSize = ruler === "Elixir Loong" ? 7 : 6; // +1 space
  const pool = allIds.slice();
  const pick=[];
  for(let i=0;i<teamSize;i++){
    const idx = Math.floor(Math.random()*pool.length);
    pick.push(pool.splice(idx,1)[0]);
  }
  document.getElementById('team').textContent = `Your ${teamSize}-member team: ${pick.join(', ')}`;
});

document.getElementById('rateBtn').addEventListener('click',()=>{
  const ruler = document.getElementById('ruler').value;
  const requiredCount = ruler === "Elixir Loong" ? 7 : 6; // +1 slot
  const chosen = document.getElementById('team').textContent.match(/[A-Za-z]+/g)||[];
  if(chosen.length!==requiredCount){
    alert(`You must pick exactly ${requiredCount} troops for ${ruler}.`);
    return;
  }
  const sc=scoreGroup(chosen);
  const totalCost = chosen.reduce((s,p)=>s+PIECES[p].cost,0);
  const details = chosen.map(pid =>
    `${pid}: type=${PIECES[pid].type} Groups=(${PIECES[pid].group1}, ${PIECES[pid].group2}) Bonus=${PIECES[pid].bonus} Cost=${PIECES[pid].cost}`
  ).join('\n');
  showResult(`Team score: ${sc.toFixed(2)} (Ruler: ${ruler}, Total cost: ${totalCost})`, details);
});

document.getElementById('customBtn').addEventListener('click',()=> modal.style.display='flex');
document.getElementById('closeModal').addEventListener('click',()=> modal.style.display='none');

document.getElementById('findCustom').addEventListener('click',()=>{
  const ruler = document.getElementById('ruler').value;
  const teamSize = ruler === "Elixir Loong" ? 7 : 6;
  const minScore = parseFloat(document.getElementById('minScore').value)||10.00;
  const attempts = 800000;

  for(let i=0;i<attempts;i++){
    const pool = allIds.slice();
    const pick=[];
    for(let j=0;j<teamSize;j++){
      const idx = Math.floor(Math.random()*pool.length);
      pick.push(pool.splice(idx,1)[0]);
    }
    const sc=scoreGroup(pick);
    if(sc>=minScore){
      const totalCost = pick.reduce((s,p)=>s+PIECES[p].cost,0);
      const details = pick.map(pid =>
        `${pid}: type=${PIECES[pid].type} Groups=(${PIECES[pid].group1}, ${PIECES[pid].group2}) Bonus=${PIECES[pid].bonus} Cost=${PIECES[pid].cost}`
      ).join('\n');
      showResult(`Custom team score: ${sc.toFixed(2)} (Ruler: ${ruler}, Total cost: ${totalCost})`, details);
      modal.style.display='none';
      return;
    }
  }
  alert("No team found.");
});

document.getElementById('bestBtn').addEventListener('click',()=>{
  const ruler = document.getElementById('ruler').value;
  const teamSize = ruler === "Elixir Loong" ? 7 : 6;
  const combos = combinations(allIds, teamSize);
  let bestScore=-Infinity, bestTeam=null;
  for(const combo of combos){
    const sc=scoreGroup(combo);
    if(sc>bestScore){ bestScore=sc; bestTeam=combo; }
  }
  const totalCost = bestTeam.reduce((s,p)=>s+PIECES[p].cost,0);
  const details = bestTeam.map(pid =>
    `${pid}: type=${PIECES[pid].type} Groups=(${PIECES[pid].group1}, ${PIECES[pid].group2}) Bonus=${PIECES[pid].bonus} Cost=${PIECES[pid].cost}`
  ).join('\n');
  showResult(`Best possible team score: ${bestScore.toFixed(2)} (Ruler: ${ruler}, Total cost: ${totalCost})`, details);
});

// --- helper to build combinations ---
function combinations(arr, k){
  const result=[];
  const helper=(start, combo)=>{
    if(combo.length===k){ result.push(combo.slice()); return; }
    for(let i=start;i<arr.length;i++) helper(i+1, combo.concat(arr[i]));
  };
  helper(0,[]);
  return result;
}
</script>
</body>
</html>
